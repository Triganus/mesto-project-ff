(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-40",headers:{authorization:"1bcd86ca-6eaa-48f0-bd30-d3e1630e888a","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var c=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.imageObserver=null,this.init()},(t=[{key:"init",value:function(){var e=this;"IntersectionObserver"in window&&(this.imageObserver=new IntersectionObserver((function(t,n){t.forEach((function(t){if(t.isIntersecting){var r=t.target;e.loadImage(r),n.unobserve(r)}}))}),{threshold:.1,rootMargin:"50px"}))}},{key:"loadImage",value:function(e){var t=e.dataset.src;if(t){e.classList.add("loading");var n=new Image;n.onload=function(){e.src=t,e.classList.remove("loading"),e.classList.add("loaded"),e.removeAttribute("data-src")},n.onerror=function(){e.classList.remove("loading"),e.classList.add("error"),console.error("Ошибка загрузки изображения:",t)},n.src=t}}},{key:"observe",value:function(e){this.imageObserver?this.imageObserver.observe(e):this.loadImage(e)}},{key:"unobserve",value:function(e){this.imageObserver&&this.imageObserver.unobserve(e)}},{key:"disconnect",value:function(){this.imageObserver&&this.imageObserver.disconnect()}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function l(e){e.classList.add("popup_opened"),document.addEventListener("keydown",s)}function u(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",s)}function s(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&u(t)}}function d(e){var t=e.querySelector(".popup__close");t&&t.addEventListener("click",(function(){return u(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&u(e)}))}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function v(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var y=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache=new Map},(t=[{key:"get",value:function(e){if(!this.cache.has(e)){var t=document.querySelector(e);return t&&this.cache.set(e,t),t}return this.cache.get(e)}},{key:"getAll",value:function(e){var t="all:".concat(e);if(!this.cache.has(t)){var n=document.querySelectorAll(e);return this.cache.set(t,n),n}return this.cache.get(t)}},{key:"clear",value:function(){this.cache.clear()}},{key:"delete",value:function(e){this.cache.delete(e),this.cache.delete("all:".concat(e))}}])&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function m(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function b(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}function h(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function _(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(n){m(e,n,t),n.setCustomValidity("")})),n?(o.disabled=!0,o.classList.add(t.inactiveButtonClass)):h(r,o,t)}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,k(r.key),r)}}function k(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}var L=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingElements=new Set},t=[{key:"showButtonLoading",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Загрузка...";e&&(e.dataset.originalText||(e.dataset.originalText=e.textContent),e.textContent=t,e.classList.add("loading"),e.disabled=!0,this.loadingElements.add(e))}},{key:"hideButtonLoading",value:function(e){e&&(e.dataset.originalText&&(e.textContent=e.dataset.originalText,delete e.dataset.originalText),e.classList.remove("loading"),e.disabled=!1,this.loadingElements.delete(e))}},{key:"showGlobalLoading",value:function(){var e=document.querySelector(".global-loader");return e||((e=document.createElement("div")).className="global-loader",e.innerHTML='\n        <div class="global-loader__spinner"></div>\n        <div class="global-loader__text">Загрузка...</div>\n      ',document.body.appendChild(e)),e.classList.add("visible"),e}},{key:"hideGlobalLoading",value:function(){var e=document.querySelector(".global-loader");e&&(e.classList.remove("visible"),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),300))}},{key:"createCardSkeleton",value:function(){var e=document.createElement("div");return e.className="card-skeleton",e.innerHTML='\n      <div class="card-skeleton__image"></div>\n      <div class="card-skeleton__content">\n        <div class="card-skeleton__title"></div>\n        <div class="card-skeleton__actions">\n          <div class="card-skeleton__like"></div>\n          <div class="card-skeleton__count"></div>\n        </div>\n      </div>\n    ',e}},{key:"clearAll",value:function(){var e=this;this.loadingElements.forEach((function(t){e.hideButtonLoading(t)})),this.hideGlobalLoading()}}],t&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},C=null,q=null,T=y.get(".places__list"),x=y.get(".profile__edit-button"),O=y.get(".profile__add-button"),P=y.get(".profile__title"),j=y.get(".profile__description"),I=y.get("[data-avatar]"),A=y.get(".profile__avatar-button"),B=y.get(".popup_type_edit"),M=y.get(".popup_type_new-card"),U=y.get(".popup_type_image"),D=y.get(".popup_type_avatar"),N=y.get(".popup_type_delete"),G=B.querySelector(".popup__form"),H=G.querySelector(".popup__input_type_name"),Z=G.querySelector(".popup__input_type_description"),W=M.querySelector(".popup__form"),z=W.querySelector(".popup__input_type_card-name"),R=W.querySelector(".popup__input_type_url"),V=D.querySelector(".popup__form"),J=V.querySelector(".popup__input_type_avatar"),F=N.querySelector(".popup__form"),Q=U.querySelector(".popup__image"),Y=U.querySelector(".popup__caption");function $(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t?L.showButtonLoading(e,n):L.hideButtonLoading(e)}function K(e){Q.src=e.link,Q.alt=e.name,Y.textContent=e.name,l(U)}function X(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=function(e,t,o,a){var i=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),l=i.querySelector(".card__image"),u=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button"),f=i.querySelector(".card__like-count");return l.dataset.src=e.link,l.alt=e.name,l.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMSIgaGVpZ2h0PSIxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InRyYW5zcGFyZW50Ii8+PC9zdmc+",c.observe(l),u.textContent=e.name,f&&(f.textContent=e.likes.length,f.style.transition="transform 0.2s ease"),e.likes.some((function(e){return e._id===t}))&&d.classList.add("card__like-button_active"),e.owner._id!==t&&(s.style.display="none"),s.addEventListener("click",(function(){return o(i,e._id)})),d.addEventListener("click",(function(){!function(e,t,o){var a=t.classList.contains("card__like-button_active")?r:n;t.style.pointerEvents="none",a(e).then((function(e){t.classList.toggle("card__like-button_active"),o&&(o.textContent=e.likes.length,o.style.transform="scale(1.2)",setTimeout((function(){o.style.transform="scale(1)"}),200))})).catch((function(e){console.error(e)})).finally((function(){setTimeout((function(){t.style.pointerEvents="auto"}),300)}))}(e._id,d,f)})),l.addEventListener("click",(function(){return a(e)})),setTimeout((function(){i.style.animationDelay="0s"}),100),i}(e,C._id,ee,K);o.style.animationDelay=t?"0s":"".concat(.3*Math.random(),"s"),t?T.prepend(o):T.append(o)}function ee(e,t){q={element:e,id:t},l(N)}x.addEventListener("click",(function(){H.value=P.textContent,Z.value=j.textContent,_(G,w),l(B)})),O.addEventListener("click",(function(){l(M)})),A.addEventListener("click",(function(){l(D)})),G.addEventListener("submit",(function(n){n.preventDefault();var r,o,a=n.target.querySelector(".popup__button");$(a,!0),(r=H.value,o=Z.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})}).then(t)).then((function(e){P.textContent=e.name,j.textContent=e.about,u(B)})).catch((function(e){console.error(e)})).finally((function(){$(a,!1)}))})),W.addEventListener("submit",(function(n){n.preventDefault();var r,o,a=n.target.querySelector(".popup__button");$(a,!0),(r=z.value,o=R.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:o})}).then(t)).then((function(e){X(e,!0),n.target.reset(),_(W,w,!0),u(M)})).catch((function(e){console.error(e)})).finally((function(){$(a,!1)}))})),V.addEventListener("submit",(function(n){n.preventDefault();var r,o=n.target.querySelector(".popup__button");$(o,!0),(r=J.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){I.style.backgroundImage="url(".concat(e.avatar,")"),n.target.reset(),_(V,w,!0),u(D)})).catch((function(e){console.error(e)})).finally((function(){$(o,!1)}))})),F.addEventListener("submit",(function(n){n.preventDefault();var r,o=n.target.querySelector(".popup__button");$(o,!0,"Удаление...","Да"),(r=q.id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then((function(){q.element.remove(),u(N),q=null})).catch((function(e){console.error(e)})).finally((function(){$(o,!1,"Удаление...","Да")}))})),d(B),d(M),d(U),d(D),d(N),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);h(n,r,t);var o,a,i=(o=function(o){b(e,o,t),h(n,r,t)},function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];clearTimeout(a),a=setTimeout((function(){o.apply(e,n)}),300)});n.forEach((function(o){o.addEventListener("blur",(function(){b(e,o,t),h(n,r,t)})),o.addEventListener("input",(function(){""===o.value.trim()?(b(e,o,t),h(n,r,t)):i(o)}))}))}(t,e)}))}(w),L.showGlobalLoading(),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];C=o,P.textContent=o.name,j.textContent=o.about,I.style.backgroundImage="url(".concat(o.avatar,")"),a.forEach((function(e,t){setTimeout((function(){X(e)}),100*t)}))})).catch((function(e){console.error(e)})).finally((function(){setTimeout((function(){L.hideGlobalLoading()}),500)})),document.querySelector("[data-logo]").src="./images/logo.0863e5bc26221680f1e2.svg"})();